?options
parallel::detectCores()
updateR()
library("installr")
updateR()
setInternet2(TRUE)
updateR()
load("C:/Users/Owner/Documents/GitHub/eysterthesis/10-25.RData")
setwd("C:/Users/Owner/Documents/github/eysterthesis")
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = factor(c('30','60'),levels=levels(as.factor(germs$strat))),
temp    =factor(c('1', '2', '3','4'), levels=levels(as.factor(germs$temp)))) # create a new data frame
Xmat <- model.matrix(~ origin*temp*strat, data=newdat)  # use exactly the same formula as for the fixed-effect part in the model specification
fitmat <- matrix(ncol=nsim, nrow=nrow(newdat))
for(i in 1:nsim) fitmat[,i] <- Xmat %*% bsim@fixef[i,]    # fitted values
head(newdat)
head(germs$temp)
unique(germs$temp)
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = factor(c('30','60'),levels=levels(as.factor(germs$strat))),
temp    =factor(c('11.3','16.0', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
Xmat <- model.matrix(~ origin*temp*strat, data=newdat)  # use exactly the same formula as for the fixed-effect part in the model specification
fitmat <- matrix(ncol=nsim, nrow=nrow(newdat))
for(i in 1:nsim) fitmat[,i] <- Xmat %*% bsim@fixef[i,]    # fitted values
head(newdat)
View(newdat)
levels(as.factor(germs$temp)))
levels(as.factor(germs$temp))
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = factor(c('30','60'),levels=levels(as.factor(germs$strat))),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
Xmat <- model.matrix(~ origin*temp*strat, data=newdat)  # use exactly the same formula as for the fixed-effect part in the model specification
fitmat <- matrix(ncol=nsim, nrow=nrow(newdat))
for(i in 1:nsim) fitmat[,i] <- Xmat %*% bsim@fixef[i,]    # fitted values
head(newdat)
fitmat
View(fitmat)
library("blmeco")
library("arm")
for(i in 1:nsim) fitmat[,i] <- Xmat %*% bsim@fixef[i,]    # fitted values
fitmat[,1]
fitmat[1,]
bsim@fixef[i,]
bsim@fixef[1,]
bsim@fixef[2,]
Xmat %*% bsim@fixef[1,]
Xmat
Xmat <- model.matrix(~ origin*temp*strat, data=newdat)  # use exactly the same formula as for the fixed-effect part in the model specification
View(Xmat)
dim(Xmat)
dim(bsim@fixef[i,])
dim(bsim@fixef[1,])
View(bsim@fixef[1,])
M = matrix( c(2,6,5,1,10,4), nrow = 2,ncol = 3,byrow = TRUE)
t = M %*% t(M)
print(t)
M
M %*% M
M<-c(1, 2, 3, 4)
M
M %*% M
mod<-lmer((log(daysfromstart))~origin*as.factor(temp)*strat +(1|sp/location/uniqind), data=subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR"))
nsim <- 2000
bsim <- sim(mod, n.sim=nsim)
str(bsim)
round(apply(bsim@fixef, 2,quantile, prob=c(0.025,0.5,0.975)),3)
typeof(germs$origin)
typeof(germs$strat)
newdat<-expand.grid(origin = character(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = numeric(c('30','60'),levels=levels(as.factor(germs$strat))),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
newdat<-expand.grid(origin = character(c('Europe','USA')),
strat    = numeric(c('30','60')),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
newdat<-expand.grid(origin = character(c('Europe','USA'), length=length(germs$origin)),
strat    = numeric(c('30','60')),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
mod<-lmer((log(daysfromstart))~as.factor(origin)*as.factor(temp)*strat +(1|sp/location/uniqind), data=subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR"))
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = numeric(c('30','60'),levels=levels(as.factor(germs$strat))),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
length(germs$strat)
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = numeric(c('30','60')),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = numeric(c('30','60'), length=2),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = (c('30','60')),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
Xmat <- model.matrix(~ origin*temp*strat, data=newdat)  # use exactly the same formula as for the fixed-effect part in the model specification
fitmat <- matrix(ncol=nsim, nrow=nrow(newdat))
for(i in 1:nsim) fitmat[,i] <- Xmat %*% bsim@fixef[i,]    # fitted values
newdat$lower <- apply(fitmat, 1, quantile, prob=0.025)
newdat$upper <- apply(fitmat, 1, quantile, prob=0.975)
newdat$fit <- Xmat %*% fixef(mod)
par(mfrow=c(1,1), mar=c(2,2,1,1), omi= c(0.5,0.5,0,0))     # "mar" sets the margins (lower, left, upper, right) around the plot
indexP <- newdat$origin=='USA'
indexC <- newdat$Implant=='Europe'
a <- 1
dat$daysNum <- ifelse(dat$days=='before', 0, as.character(dat$days)) # nummeric day variable
dat$daysNum <- as.numeric(dat$daysNum) # nummeric day variable
newdat
View$newdat
View(newdat)
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
segments(c(0,2,20)-c(0.4,0.4,0.4), newdat$lower[indexP], c(0,2,20)-c(0.4,0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
points(c(0,2,20)-c(0.4,0.4,0.4), newdat$fit[indexP], lwd=2 ,pch=16, col="black", cex=1.2)     # Placebo
segments(c(0,2,20)+c(0.2,0.2,0.2), newdat$upper[indexC], c(0,2,20)+c(0.2,0.2,0.2), newdat$lower[indexC],lty=1, lwd=2, col="black" )  # CrI
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[dat$Implant=='P']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
unique(germs$origin)
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange", cex=0.5, lty=2)   # Cort raw data
segments(c(0,2,20)-c(0.4,0.4,0.4), newdat$lower[indexP], c(0,2,20)-c(0.4,0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
indexP <- newdat$origin=='USA'
indexC <- newdat$Implant=='Europe'
points(c(0,2,20)-c(0.4,0.4,0.4), newdat$fit[indexP], lwd=2 ,pch=16, col="black", cex=1.2)     # Placebo
newdat$fit[indexP]
c(0,2,20)-c(0.4,0.4,0.4)
points(c(0,2)-c(0.4,0.4), newdat$fit[indexP], lwd=2 ,pch=16, col="black", cex=1.2)     # Placebo
indexC <- newdat$origin=='Europe'
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange", cex=0.5, lty=2)   # Cort raw data
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
points(jitter(germs$strat[germs$origin=='Europe']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
points(jitter(germs$strat[germs$origin=='Europe']-0.4), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
segments(c(0,2,20)-c(0.4,0.4,0.4), newdat$lower[indexP], c(0,2,20)-c(0.4,0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
points(c(0,2,20)-c(0.4,0.4,0.4), newdat$fit[indexP], lwd=2 ,pch=16, col="black", cex=1.2)     # Placebo
segments(c(0,2,20)+c(0.2,0.2,0.2), newdat$upper[indexC], c(0,2,20)+c(0.2,0.2,0.2), newdat$lower[indexC],lty=1, lwd=2, col="black" )  # CrI
points(c(0,2,20)+c(0.2,0.2,0.2), newdat$fit[indexC], lwd=1 ,lty=1, pch=21, bg="white", col="black", cex=1.2) # CORT
newdat$fit[indexC]
axis(side=2, labels=F,at=seq(0,4.8,0.4),line=0,tcl=-0.3,las=1)
axis(side=2, labels=seq(0,4.8,0.4),at=seq(0,4.8,0.4),line=0,tcl=-0.3,las=1, mgp=c(3,0.5,0),cex.axis=a)
axis(side=1, labels=c(NA, 2,20),at=c(0, 2,20),line=0,tcl=-0.3,las=1)
axis(side=1, labels=c("before"),at=c(-0.5),line=0,tcl=0,las=1)
mtext(side=2,line=3,adj=0.5,cex=a,font=2,"Total corticosterone [log, ng/ml]",las=0,outer=FALSE)
mtext(side=1,line=3,adj=0.5,cex=a,font=2,"Days after implantation",outer=FALSE)
points(c(10,10),c(4.5,4.8),pch=21,bg=c("black","white"))
text(c(11,11),c(4.5,4.8),c("placebo", "corticosterone"),adj=c(0,0.5))
log(germs$daysfromstart[germs$origin=='USA'])
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
points(1, log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
jitter(germs$strat[germs$origin=='Europe']+0.2)
newdat$fit[indexC]
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
typeof(germs$strat)
as.numeric(germs$strat)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
ggplot(germs, aes(x=jitter(germs$strat[germs$origin=='USA']-0.4),y=log(germs$daysfromstart[germs$origin=='USA']))+geom_point()
ladsjlfakjdslfja
lasjdf
ggplot(germs, aes(x=jitter(germs$strat[germs$origin=='USA']-0.4),y=log(germs$daysfromstart[germs$origin=='USA'])))+geom_point()
library(ggplot2)
ggplot(germs, aes(x=jitter(germs$strat[germs$origin=='USA']-0.4),y=log(germs$daysfromstart[germs$origin=='USA'])))+geom_point()
ggplot( aes(x=jitter(germs$strat[germs$origin=='USA']-0.4),y=log(germs$daysfromstart[germs$origin=='USA'])))+geom_point()
ggplot(germs, aes(x=jitter(germs$strat[germs$origin=='USA']-0.4),y=log(germs$daysfromstart[germs$origin=='USA'])))+geom_point()
ggplot(germs, aes(x=jitter($strat[$origin=='USA']-0.4),y=log($daysfromstart[$origin=='USA'])))+geom_point()
ggplot(germs, aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))+geom_point()
ggplot(germs, aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))
ggplot(subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR"), aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))
ggplot(subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR"),
aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))+geom_point()
germs<-subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR")
par(mfrow=c(1,1), mar=c(2,2,1,1), omi= c(0.5,0.5,0,0))     # "mar" sets the margins (lower, left, upper, right) around the plot
indexP <- newdat$origin=='USA'
indexC <- newdat$origin=='Europe'
a <- 1
#germs$stratNum <- ifelse(germs$strat=='before', 0, as.character(dat$days)) # nummeric day variable
#dat$daysNum <- as.numeric(dat$daysNum) # nummeric day variable
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
ggplot(subset(germs,
aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))+geom_point()
alskdjflaksdjf
a
j
ggplot(germs,
aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))+geom_point()
;alsdkjflaksdjf
ggplot(germs,
aes(x=jitter(strat[germs$origin=='USA']-0.4),y=log(daysfromstart[germs$origin=='USA'])))+geom_point()
ax=jitter(strat[germs$origin=='USA']-0.4)
p$c<-jitter(germs$strat[germs$origin=='USA']-0.4)
p<-data.frame()
p$c<-jitter(germs$strat[germs$origin=='USA']-0.4)
points(1, 3)
jitter(germs$strat[germs$origin=='USA']-0.4)
log(germs$daysfromstart[germs$origin=='USA'])
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']))         # Placebo raw data
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA'])))
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']))
View(p)
ggplot(p,
aes(x=[,1], y=[,2])+geom_point()
ggplot(p,
aes(x=p[,1], y=p[,2])+geom_point()
'lakdfja'
ggplot(p, aes(x=p[,1], y=p[,2]))+geom_point()
points(p[,1], p[,2])
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(p[,1], p[,2])
ggplot(p, aes(x=p[,1], y=p[,2]))+geom_point(color="blue")
q<-data.frame(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe'])
)
q<-data.frame(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']))
ggplot(q, aes(x=q[,1], y=q[,2]))+geom_point(color="orange")
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']))
ggplot(p, aes(x=p[,1], y=p[,2]))+geom_point(color="blue")
q<-data.frame(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']))
geom_point(aes(x=q[,1], y=q[,2])),color="orange")
geom_point(q, aes(x=q[,1], y=q[,2])),color="orange")
geom_point( aes(x=q[,1], y=q[,2]), color="orange")
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']))
ggplot(p, aes(x=p[,1], y=p[,2]))+geom_point(color="blue")+
geom_point(aes(x=q[,1], y=q[,2]), color="orange")
p[,3]<-jitter(germs$strat[germs$origin=='Europe']+0.2)
points(p)
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(p)
plotp(p)
plot(p)
plot(q)
plot(p, col="blue")
plot(q, col="orange")
plot(p, col="blue")
points(q, col="orange")
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']))
q<-data.frame(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']))
plot(p, col="blue")
points(q, col="orange")
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-1), log(germs$daysfromstart[germs$origin=='USA']))
q<-data.frame(jitter(germs$strat[germs$origin=='Europe']+1), log(germs$daysfromstart[germs$origin=='Europe']))
plot(p, col="blue")
points(q, col="orange")
p<-data.frame(jitter(germs$strat[germs$origin=='USA']-.4)-5, log(germs$daysfromstart[germs$origin=='USA']))
q<-data.frame(jitter(germs$strat[germs$origin=='Europe']+0.2)+5, log(germs$daysfromstart[germs$origin=='Europe']))
plot(p, col="blue")
points(q, col="orange")
segments(c(0,2,20)-c(0.4,0.4,0.4), newdat$lower[indexP], c(0,2,20)-c(0.4,0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
points(c(0,2,20)-c(0.4,0.4,0.4), newdat$fit[indexP], lwd=2 ,pch=16, col="black", cex=1.2)     # Placebo
segments(c(0,2,20)+c(0.2,0.2,0.2), newdat$upper[indexC], c(0,2,20)+c(0.2,0.2,0.2), newdat$lower[indexC],lty=1, lwd=2, col="black" )  # CrI
points(c(0,2,20)+c(0.2,0.2,0.2), newdat$fit[indexC], lwd=1 ,lty=1, pch=21, bg="white", col="black", cex=1.2) # CORT
segments(c(30,40)-c(0.4,0.4), newdat$lower[indexP], c(0,2,20)-c(0.4,0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
plot(p, col="blue")
points(q, col="orange")
segments(c(30,40)-c(0.4,0.4), newdat$lower[indexP], c(30, 40)-c(0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
segments(c(30, 40)+c(0.2,0.2), newdat$upper[indexC], c(30, 40)+c(0.2,0.2), newdat$lower[indexC],lty=1, lwd=2, col="black" )  # CrI
axis(side=2, labels=F,at=seq(0,4.8,0.4),line=0,tcl=-0.3,las=1)
axis(side=2, labels=seq(0,4.8,0.4),at=seq(0,4.8,0.4),line=0,tcl=-0.3,las=1, mgp=c(3,0.5,0),cex.axis=a)
axis(side=1, labels=c(NA, 2,20),at=c(0, 2,20),line=0,tcl=-0.3,las=1)
axis(side=1, labels=c("before"),at=c(-0.5),line=0,tcl=0,las=1)
mtext(side=2,line=3,adj=0.5,cex=a,font=2,"Total corticosterone [log, ng/ml]",las=0,outer=FALSE)
mtext(side=1,line=3,adj=0.5,cex=a,font=2,"Days after implantation",outer=FALSE)
points(c(10,10),c(4.5,4.8),pch=21,bg=c("black","white"))
text(c(11,11),c(4.5,4.8),c("placebo", "corticosterone"),adj=c(0,0.5))
germs<-subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR")
mod<-lmer((log(daysfromstart))~as.factor(origin)*as.factor(temp)*strat +(1|sp/location/uniqind), data=subset(germs, germinated==1 & sp!="PLAMED" & sp!="PLACOR"))
mod
##Resid plots for lmer {lme4}:
par(mfrow=c(2,2), mar=c(4,4,2,1), mgp=c(2.2,0.8,0))
scatter.smooth(fitted(mod), resid(mod)); abline(h=0, lty=2)
mtext("Tukey-Anscombe Plot", 3, line=0.8, cex=0.8)  # residuals vs. fitted
#A positive correlation between the residuals and the fitted values (not present in the example data) would not bother us statistically, but it indicates strong shrinkage and may have biological meaning.
qqnorm(resid(mod), main="normal qq-plot, residuals", cex.main=0.8) # qq of residuals
qqline(resid(mod))
scatter.smooth(fitted(mod), sqrt(abs(resid(mod)))) # res. var vs. fitted
qqnorm(ranef(mod)$sp[,1], main="normal qq-plot, random effects", cex.main=0.8)
qqline(ranef(mod)$sp[,1]) # qq of random effects. These should be normally distributed
#comparing the qq norm plot to random samples:
compareqqnorm(mod) #ours doesn't look too normal...
nsim <- 2000
bsim <- sim(mod, n.sim=nsim)
str(bsim)
round(apply(bsim@fixef, 2,quantile, prob=c(0.025,0.5,0.975)),3)
#------------------------------------------------Plotting the fitted values-------------------
newdat<-expand.grid(origin = factor(c('Europe','USA'),levels=levels(as.factor(germs$origin))),
strat    = (c('30','60')),
temp    =factor(c('11.3','16', '20.7', '25.3'), levels=levels(as.factor(germs$temp)))) # create a new data frame
Xmat <- model.matrix(~ origin*temp*strat, data=newdat)  # use exactly the same formula as for the fixed-effect part in the model specification
fitmat <- matrix(ncol=nsim, nrow=nrow(newdat))
for(i in 1:nsim) fitmat[,i] <- Xmat %*% bsim@fixef[i,]    # fitted values
newdat$lower <- apply(fitmat, 1, quantile, prob=0.025)
newdat$upper <- apply(fitmat, 1, quantile, prob=0.975)
newdat$fit <- Xmat %*% fixef(mod)
par(mfrow=c(1,1), mar=c(2,2,1,1), omi= c(0.5,0.5,0,0))     # "mar" sets the margins (lower, left, upper, right) around the plot
indexP <- newdat$origin=='USA'
indexC <- newdat$origin=='Europe'
a <- 1
#germs$stratNum <- ifelse(germs$strat=='before', 0, as.character(dat$days)) # nummeric day variable
#dat$daysNum <- as.numeric(dat$daysNum) # nummeric day variable
plot(seq(-2,22,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
plot(seq(-2,80,1), seq(-0.1,4.8,length=25), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
plot(seq(-2,77,1), seq(-0.1,4.8,length=80), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4), log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2), log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
plot(seq(-2,77,1), seq(-0.1,4.8,length=80), yaxt="n", xaxt="n", type="n", xlab="", ylab="", las=2, cex.lab=a,
main="", cex.main=a, font.main=1)
points(jitter(germs$strat[germs$origin=='USA']-0.4)-5, log(germs$daysfromstart[germs$origin=='USA']), lwd=2 ,pch=16, col="blue",   cex=0.5)          # Placebo raw data
points(jitter(germs$strat[germs$origin=='Europe']+0.2)+5, log(germs$daysfromstart[germs$origin=='Europe']), lwd=2 ,pch=16, col="orange",   cex=0.5, lty=2) #cort raw data
segments(c(30,60)-c(0.4,0.4), newdat$lower[indexP], c(30, 60)-c(0.4,0.4), newdat$upper[indexP], lty=1, lwd=2, col="black" ) # CrI
segments(c(30, 60)+c(0.2,0.2), newdat$upper[indexC], c(30, 60)+c(0.2,0.2), newdat$lower[indexC],lty=1, lwd=2, col="black" )  # CrI
newdat$lower[indexP]
modrater<-glmer(germinated~origin*as.factor(temp)*strat+(1|sp/location/uniqind),
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
d("C:/Users/Owner/Documents/github/eysterthesis")
## Get files
height<- read.csv("input/height_data_2-13-16.csv", header=TRUE) #Read the height file
germ <- read.csv("input/Germ_Data_2-9-16.csv", header=TRUE) #read the germination file
id<- read.csv("input/id_Data-2-4-16.csv", header=TRUE) #read the id file
lab1<-read.csv("input/label.csv", header=TRUE) #read in the graph labeling file
## basic data cleaning
#rename the columns
names(height)<- c("trayloc", "substrate", "measuredate", "plantheight" )
names(germ) <- c("trayloc", "substrate", "germdate")
names(id) <- c("trayloc", "sp", "strat", "temp", "individual", "location", "substrate")
#reformat the dates
germ$germdate <- as.Date(germ$germdate, format="%m/%d/%Y")
germ$doy <- as.numeric(format(germ$germdate, "%j"))
height$measuredate <- as.Date(height$measuredate, format="%m/%d/%Y") #this line doesn't work -- won't save in correct format
#height$heightdate <-format(height$measuredate, "%b/%d/%Y")
germ$daysfromstart <- ifelse(germ$doy<100, (germ$doy)+38, (germ$doy)-327) # use start date of 23 Nov 2015, and account for 2016 vs. 2015 date
#create unique identifiers for each seed
germ$uniqueid<- NA
germ$uniqueid<-do.call(paste, c(germ[c("trayloc", "substrate")], sep=""))
id$uniqueid<- NA
id$uniqueid<-do.call(paste, c(germ[c("trayloc", "substrate")], sep=""))
height$uniqueid<- NA
height$uniqueid<-do.call(paste, c(height[c("trayloc", "substrate")], sep=""))
height$plantheight<-as.numeric(height$plantheight) # make the plant height measurements numerical
#merge the germ and id data frames
germid <- merge(germ,id,by=("uniqueid"))
colnames(germid)[2]<-"trayloc"
colnames(germid)[3]<-"substrate"
germid$substrate.y<-NULL #remove duplicate columns
germid$trayloc.y<-NULL #remove duplicate columns
#create column for continental origin
germid$origin[which(grepl("EU", germid$individual)==TRUE)] <- "Europe"
germid$origin[which(grepl("US", germid$individual)==TRUE)] <- "USA"
germid$location<-do.call(paste, c(germid[c("origin", "location")], sep="--"))
## Assign the treatments an average temp
# 18/8, 22.67/12.67C, 27.33/17.33, and 32/22
germid$temp[germid$temp=="LL"] <- round((16*8+18*8)/24, digits=1)
germid$temp[germid$temp=="LM"] <- round((16*12.67+22.67*8)/24, digits=1)
germid$temp[germid$temp=="HM"] <- round((16*17.33+27.33*8)/24, digits=1)
germid$temp[germid$temp=="HH"] <- round((16*22+32*8)/24, digits=1)
germid$temp <- as.numeric(germid$temp)
#add column to for current germ rate, setting germinated seeds to 1, ungerminated to 0
germid$germinated <- germid$doy
germid$germinated[is.na(germid$germinated)==TRUE] <- 0
germid$germinated[germid$germinated>0] <- 1
#subset the data by substrate
germs<-subset(germid, substrate=="Soil", select=uniqueid:germinated) #subset with data from seeds planted in soil
germf<-subset(germid, substrate=="Filter", select=uniqueid:germinated) #subset with data from seeds planted on filter paper
#hist(germs$daysfromstart, breaks=10)
#hist(germf$daysfromstart, breaks=10)
#hist(subset(germid, substrate="Soil", select=daysfromstart), breaks=10 )
#germid$soil[which(grepl("Soil", germid$uniqueid)==TRUE)]<- "10"
#table(germid[which(germid$substrate=="Filter"),],germid$daysfromstart, germid$sp, germid$origin, useNA="always")
table(germs$daysfromstart, germs$sp, useNA="always") #table to view germination date data for soil seeds
table(germf$daysfromstart, germf$sp, useNA="always") #table to view germination date data for filter paper seeds
germcheckf <- table(germf$germinated, germf$sp, useNA="always")
germchecks <-table(germs$germinated, germs$sp, useNA="always")
# calculate percent germinated
percentgermf<-germcheckf[2,]/(germcheckf[1,]+germcheckf[2,]) #percent germinated for filter paper
percentgermf
percentgerms<-germchecks[2,]/(germchecks[1,]+germchecks[2,]) #percent germinated for soil
percentgerms
germs$uniqind<-NA
germs$uniqind<- do.call(paste, c(germs[c("sp", "individual")], sep="_")) #creates a column that defines the individual
modrater<-glmer(germinated~origin*as.factor(temp)*strat+(1|sp/location/uniqind),
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
modrater<-glmer(germinated~origin*as.factor(temp)*strat+(1|sp),
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
View(germs)
library("MASS")
modraterp<-glmmPQL(germinated~origin*as.factor(temp)*strat, random=~1|sp/location/uniqind,
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR"))
View(fitmat)
Fiew(Xmat)
View(Xmat)
modr<-glm(germinated~strat,
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
mod
modr
plot(modr)
germs<-subset(germs, sp!="PLAMED" & sp!="PLACOR")
plot(fitted(modr), jitter(germs$germinated, amount=.05), xlab="Fitted values", )
plot(fitted(modr), jitter(germs$germinated, amount=.05), xlab="Fitted values", ylab="prob of presence", las=1, cex.lab=1.2, cex=.8 )
abline(0,1, lty=3)
bsim1<-sim(modr, n.sim=2000)
apply(bsim1@coef, 2, mean)
apply(bsim1@coef, 2, quantile, prob=c(0.25, 0.975))
modr<-glm(germinated~origin*strat,
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
bsim1<-sim(modr, n.sim=2000)
apply(bsim1@coef, 2, mean)
apply(bsim1@coef, 2, quantile, prob=c(0.25, 0.975))
modr<-glm(germinated~origin*temp,
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
modr<-glm(germinated~origin*as.factor(temp),
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
modr<-glm(germinated~origin*as.numeric(temp),
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
modr<-glm(germinated~origin,
family=binomial(link="logit"),
data=subset(germs, sp!="PLAMED" & sp!="PLACOR")) #fails to converge
bsim1<-sim(modr, n.sim=2000)
apply(bsim1@coef, 2, mean)
apply(bsim1@coef, 2, quantile, prob=c(0.25, 0.975))
